---
- hosts: all,!bastion
  become: yes
  serial: 1

  tasks:
    - name: Copy sources.list into place
      copy:
        src: '{{ root_dir }}/etc/apt/sources.list'
        dest: /etc/apt/sources.list
        mode: 0644

    - name: Install apt packages
      apt:
        name: '{{ apt_depends }}'
        update_cache: yes
        state: latest

    - name: Install pip packages
      pip:
        name: '{{ pip_depends }}'

    - name: Install pip3 packages
      pip:
        name: '{{ pip3_depends }}'
        executable: pip3

    - name: Create group account
      group:
        name: zuul

    - name: Create user account
      user:
        name: zuul
        group: zuul
        home: /home/zuul
        createhome: yes

    - name: Create ssh directory
      file:
        dest: /home/zuul/.ssh
        owner: zuul
        group: zuul
        mode: 0700
        state: directory

    - name: Create ssh private key
      template:
        src: ~/.ssh/id_rsa
        dest: /home/zuul/.ssh/id_rsa
        owner: zuul
        group: zuul
        mode: 0600

    - name: Create ssh public key
      template:
        src: ~/.ssh/id_rsa.pub
        dest: /home/zuul/.ssh/id_rsa.pub
        owner: zuul
        group: zuul
        mode: 0644
